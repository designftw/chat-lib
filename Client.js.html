<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      Client.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="5518490" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=3020267><div class="accordion-heading child"><a href="Account.html">Account</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Account.html#toJSON">toJSON</a></li></ul></li><li class="accordion collapsed child" id=7333685><div class="accordion-heading child"><a href="BaseModel.html">BaseModel</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="BaseModel.html#toJSON">toJSON</a></li></ul></li><li class="accordion collapsed child" id=9462488><div class="accordion-heading child"><a href="Client.html">Client</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Client.html#addFriend">addFriend</a></li><li data-type='method'><a href="Client.html#createIdentity">createIdentity</a></li><li data-type='method'><a href="Client.html#createPrivateData">createPrivateData</a></li><li data-type='method'><a href="Client.html#deleteIdentity">deleteIdentity</a></li><li data-type='method'><a href="Client.html#deleteMessage">deleteMessage</a></li><li data-type='method'><a href="Client.html#deletePrivateData">deletePrivateData</a></li><li data-type='method'><a href="Client.html#getFriends">getFriends</a></li><li data-type='method'><a href="Client.html#getIdentities">getIdentities</a></li><li data-type='method'><a href="Client.html#getIdentity">getIdentity</a></li><li data-type='method'><a href="Client.html#getLoggedInAccount">getLoggedInAccount</a></li><li data-type='method'><a href="Client.html#getMessageById">getMessageById</a></li><li data-type='method'><a href="Client.html#getMessages">getMessages</a></li><li data-type='method'><a href="Client.html#getPrivateData">getPrivateData</a></li><li data-type='method'><a href="Client.html#groupMessagesByUniqueRecipients">groupMessagesByUniqueRecipients</a></li><li data-type='method'><a href="Client.html#login">login</a></li><li data-type='method'><a href="Client.html#logout">logout</a></li><li data-type='method'><a href="Client.html#removeFriend">removeFriend</a></li><li data-type='method'><a href="Client.html#sendMessage">sendMessage</a></li><li data-type='method'><a href="Client.html#signup">signup</a></li><li data-type='method'><a href="Client.html#updateIdentity">updateIdentity</a></li><li data-type='method'><a href="Client.html#updateMessage">updateMessage</a></li><li data-type='method'><a href="Client.html#updatePrivateData">updatePrivateData</a></li></ul></li><li class="accordion collapsed child" id=9312854><div class="accordion-heading child"><a href="Identity.html">Identity</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Identity.html#toJSON">toJSON</a></li><li data-type='method'><a href="Identity.html#toString">toString</a></li></ul></li><li class="accordion collapsed child" id=3115779><div class="accordion-heading child"><a href="Message.html">Message</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Message.html#toJSON">toJSON</a></li></ul></li><li class="accordion collapsed child" id=6986227><div class="accordion-heading child"><a href="PrivateData.html">PrivateData</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="PrivateData.html#toJSON">toJSON</a></li></ul></li></ul> </div><div class="accordion collapsed" id="5644501" > <h3 class="accordion-heading">Events<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#event:message">message</a></li><li class="accordion-list" id=""><a href="global.html#event:messagedeletion">messagedeletion</a></li><li class="accordion-list" id=""><a href="global.html#event:messageupdate">messageupdate</a></li></ul> </div><div class="accordion collapsed" id="8696174" > <h3 class="accordion-heading">Global<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#intersection">intersection</a></li><li class="accordion-list" id=""><a href="global.html#messageEventDetails">messageEventDetails</a></li><li class="accordion-list" id=""><a href="global.html#toArray">toArray</a></li><li class="accordion-list" id=""><a href="global.html#unique">unique</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        Client.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Account from "./models/Account.js";
import Identity from "./models/Identity.js";
import Message from "./models/Message.js";
import PrivateData from "./models/PrivateData.js";

import WebSocketEndpoint from "./endpoints/WebSocketEndpoint.js";
import AuthEndpoint from "./endpoints/AuthEndpoint.js";
import IdentitiesEndpoint from "./endpoints/IdentitiesEndpoint.js";
import MessagesEndpoint from "./endpoints/MessagesEndpoint.js";
import PrivateDataEndpoint from "./endpoints/PrivateDataEndpoint.js";
import FriendsEndpoint from "./endpoints/FriendsEndpoint.js";

import { toArray, intersection, unique } from "./util.js";

/**
 * autherror: detail is {message, handle}
 */

/**
 * Object passed to details on CustomEvents about messages fired by the Client.
 * @typedef {object} messageEventDetails
 * @property {string} messageId the id of the message the event is referring to
 * @property {string} handle the handle the event is associated with.
 */

/**
 * Delete Message Event. Called when a message is deleted.
 *
 * When a message is deleted it no longer exists on the server so you cannot call
 * [getMessageById]{@link Client#getMessageById} to get information about a deleted message.
 * @event messagedeletion
 * @type {CustomEvent}
 * @property {messageEventDetails} detail the detail contains a messageEventDetails with the id and handle name of the message which was deleted.
 */

/**
 * Update Message Event
 *
 * Called when a message is updated. For example if the data changes. Use
 * [getMessageById]{@link Client#getMessageById} to get information about the updatedMessage such as the
 * new data.
 * @event messageupdate
 * @type {CustomEvent}
 * @property {messageEventDetails} detail the detail contains a messageEventDetails with the id and handle name of the message which was updated.
 */

/**
 * New Message Event
 *
 * Called when a new message is available. Call [getMessageById]{@link Client#getMessageById} to get
 * information about the new message.
 * @event message
 * @type {CustomEvent}
 * @property {messageEventDetails} detail the detail contains a messageEventDetails with the id and handle name of the message which was created.
 */

/**
 * ```js
 * import Client from "https://designftw.github.io/chat-lib/src/Client.js";
 * ```
 *
 * The Client is the interface for interacting with the ChatServer.
 *
 *
 * @fires messagedeletion
 * @fires messageupdate
 * @fires message
 */
export default class Client extends EventTarget {
  /**
   * The host of the chat server. Includes the hostname and port.
   * @type {string}
   */
  #host;

  /**
  * Helper class for authorization routes.
  * @type {AuthEndpoint}
  */
  #auth;

  /**
  * Helper class for handle routes.
  * @type {IdentitiesEndpoint}
  */
  #identities;

  /**
  * Helper class for message routes.
  * @type {MessagesEndpoint}
  */
  #messages;

  /**
  * Helper class for private data routes.
  * @type {PrivateDataEndpoint}
  */
  #privateData;

  /**
  * Helper class for friends routes.
  * @type {FriendsEndpoint}
  */
  #friends;

  /**
   * Helper class for web socket routes.
   * @type {WebSocketEndpoint}
   */
  #webSocket;

  /**
   * Client constructor.
   * @param {string} host see [Client's host property]{@link Client#host}
   */
  constructor(host) {
    super();

    this.#host = host;
    this.#auth = new AuthEndpoint(this);
    this.#identities = new IdentitiesEndpoint(this);
    this.#messages = new MessagesEndpoint(this);
    this.#privateData = new PrivateDataEndpoint(this);
    this.#friends = new FriendsEndpoint(this);
    this.#webSocket = new WebSocketEndpoint(this);

    /**
    * The logged in client account. Set in [login]{@link Client#login} and
    * unset in [logout]{@link Client#logout}.
    * @type {Account | undefined}
    */
    this.account = undefined;

    // Redirect all events from private objects to the Client object
    for (let event of ["message", "messageupdate", "messagedeletion", "autherror"]) {
      this.#webSocket.addEventListener(event, evt => {
        let evtCopy = new CustomEvent(evt.type, { detail: evt.detail });
        this.dispatchEvent(evtCopy);
      });
    }
  }

  /**
   * The host of the chat server. Includes the hostname and port.
   * For example https://mozilla.org:4000.
   * Read-only.
   *
   * See https://developer.mozilla.org/en-US/docs/Web/API/URL/host
   * @type {string}
   */
  get host() {
    return this.#host;
  }

  /**
   * Sign up for a new account with a single initial handle.
   * @param {string} handle The name of the initial handle if signup is successful.
   * @param {string} email The email address associated with the account.
   * @param {string} password The password associated with the account.
   * @returns {Promise&lt;{message: string}>} A validation message
   */
  signup(handle, email, password) {
    return this.#auth.signup(handle, email, password);
  }

  /**
   * Login to an existing account.
   * @param {string} email The email address associated with the account.
   * @param {string} password The password associated with the account.
   * @returns {Promise&lt;Account>} Upon success returns the account which was logged in.
   */
  async login(email, password) {
    let account = await this.#auth.login(email, password);
    this.#postLogin(account);
    return this.account;
  }

  /**
   * Logout of an existing account
   */
  async logout() {
    await this.#auth.logout();
    this.unsubscribe(this.account.handle);
    this.account = undefined;
    this.dispatchEvent(new CustomEvent("logout"));
    return;
  }

  /**
   * Check if the user is currently logged in
   * @returns {Promise&lt;Account | null>} Returns the account if the user is logged in, otherwise returns undefined.
   */
  async getLoggedInAccount() {
    let {isLoggedIn, account} = await this.#auth.isLoggedIn();

    if (!isLoggedIn) {
      return null;
    }

    this.#postLogin(account);

    return account;
  }

  #postLogin(account) {
    this.account = account;
    this.subscribe(this.account.handle);
    this.dispatchEvent(new CustomEvent("login", { detail: { account: this.account } }));
  }

  /**
   * Get an array of all messages that match the provided filters (see below).
   * Note that regardless of the filters provided, only messages the currently logged in account has access to will be returned.
   *
   * @param {Object} options
   * @param {string | Identity | string[] | Identity[]} [options.from] Sender(s) of the messages, either as handle(s) or Identity object(s)
   * @param {string | Identity | string[] | Identity[]} [options.to] Recipient(s) of the messages, either as handle(s) or Identity object(s)
   * @param {string[] | Identity[]} [options.participants] Senders OR recipient(s) of the messages, either as handle(s) or Identity object(s)
   * @param {Date} [options.since] an optional date to limit the request by. only receive messages since this date.
   * @param {Date} [options.exact = false] Do we want to return messages that match the `to` and `participants` params exactly, or messages that contain at least one handle in each of these arrays?
   * E.g. if we specify `to: ["A", "B"]`, do we want messages sent to either A, or B, or both, or both plus some other people, or messages sent to exactly A and B?
   * @returns {Promise&lt;Message[]>} a list of messages which pass the filters.
   */
  async getMessages({ from = [], to = [], participants = [], since, exact = false } = {}) {
    // Normalize senders and recipients to arrays of handles
    from = toArray(from).map(sender => sender instanceof Identity? sender.handle : sender);
    from = unique(from);
    to = toArray(to).map(recipient => recipient instanceof Identity? recipient.handle : recipient);
    to = unique(to);
    participants = participants.map(recipient => recipient instanceof Identity? recipient.handle : recipient);

    if (from.length > 1 &amp;&amp; exact) {
      throw new Error("Cannot specify more than one sender in ‘from’ when we are looking for exact matches, since messages only have one sender.");
    }

    participants.push(...from, ...to);
    participants = unique(participants);

    let messages = await this.#messages.getMessagesForAlias(this.account.handle, participants, since);

    // Filter messages to only those that match the provided filters
    messages = messages.filter(message => {
      let sender = message.sender.handle;

      if (from.length > 0 &amp;&amp; !from.includes(sender)) {
        // Filtering by sender(s)
        return false;
      }

      let recipients = message.recipients.map(recipient => recipient.handle);

      if (to.length > 0) {
        // Filtering by recipient(s)
        let toIntersection = intersection(recipients, to);

        if (exact) {
          if (toIntersection.size !== to.length) {
            return false;
          }
        }
        else {
          if (toIntersection.size === 0) {
            return false;
          }
        }
      }

      if (participants.length > from.length + to.length) {
        // We were also filtering by participants
        // We only need to do something here if exact = true,
        // otherwise the filtering is already done on the server
        if (exact) {
          let messageParticipants = unique([sender, ...recipients]);

          return intersection(messageParticipants, participants).size === participants.length;
        }
      }

      return true;
    });

    return messages;
  }

  /**
   * Get a message object for a message id or
   * Get a message which has the passed in messageId, and was sent or received by the passed in handle.
   *
   * Note the currently logged in account must own the handle associated with the handle.
   * @param messageId The id of the message to get.
   * @param {Object} options
   * @param {string} [options.handle] the handle which sent or received the message, as an optional safeguard against race conditions.
   * @returns {Promise&lt;Message>} The model of the message with the associated id.
   */
  getMessageById(messageId, { handle = this.account.handle } = {}) {
    return this.#messages.getMessage(handle, messageId);
  }

  /**
   * Send a message from the passed in handle to the passed in recipients with the passed in data.
   *
   * Note the currently logged in account must own the handle associated with the handle.
   * @param {Object} options
   * @param {string | Identity} options.from the sender, either a handle or Identity object
   * @param {string | string[] | Identity | Identity[]} options.to One or more recipients of the message, either as handles or Identity objects
   * @param {Object} options.data the data associated with the message.
   * @returns {Promise&lt;Message>} The model of the sent message.
   */
  sendMessage({from = this.account.handle, to, data}) {
    from = from instanceof Identity? from.handle : from;
    to = toArray(to).map(recipient => recipient instanceof Identity? recipient.handle : recipient);
    console.log(from, to, data);
    return this.#messages.sendMessage(from, to, data);
  }

  /**
   * Update a message with the passed in message id which was sent by the passed in handle.
   * @param {Message | string} message Message object or message id
   * @param {Object} options
   * @param {string} [options.handle] the handle which sent the message.
   * @param {Object} options.data the updated data associated with the message
   * @returns {Promise&lt;Message>} The Message object of the updated message.
   */
  updateMessage(message, {handle = this.account.handle, data}) {
    let id = message instanceof Message? message.id : message;
    return this.#messages.updateMessage(handle, id, data);
  }

  /**
   * Delete a message with the passed in messageId which was sent by the passed in handle.
   * @param {Message | string} message Message object or message id
   * @param {Object} [options]
   * @param {string} [options.handle] the handle which sent the message.
   * @returns {Promise&lt;any>} a validation message.
   */
  deleteMessage(message, {handle = this.account.handle} = {}) {
    let id = message instanceof Message? message.id : message;
    return this.#messages.deleteMessage(handle, id);
  }

  /**
   * Get all the handles for the currently logged in account.
   * @returns {Promise&lt;Identity[]>} An array of Alias models.
   */
  async getIdentities() {
    return this.#identities.getAliasesForAccount();
  }

  /**
   * Get an identity by its handle.
   * If an Identity object is passed in, it will just be returned.
   * This way this function can be used to normalize a handle | Identity object into an Identity object.
   *
   * @param {string | Identity} handle the handle to get
   * @returns {Promise&lt;Identity>} The Alias model associated with the passed in name
   */
  async getIdentity(handle) {
    if (handle instanceof Identity) {
      return handle;
    }

    return this.#identities.getAlias(handle);
  }

  /**
   * Create a new identity with the passed in handle and data.
   * @param {Object} options
   * @param {string} options.handle the name of the new handle
   * @param {Object} [options.data] the data to associate with the handle
   * @returns {Promise&lt;Identity>} The Identity object that corresponds to the new handle
   */
  createIdentity({handle, data}) {
    return this.#identities.createAlias(handle, data);
  }

  /**
   * Update an existing identity.
   * @param {string} handle the handle to update.
   * @param {Object} updates object containing the updates to the handle.
   * @param {Object} [updates.data] the optional new data for the handle
   * @returns {Promise&lt;Identity>} The Identity object that was updated
   */
  updateIdentity(handle, { data: newData } = {}) {
    return this.#identities.updateAlias(handle, {newData});
  }

  /**
   * Delete the identity associated with the passed in handle name.
   * @param {string} handle the handle to delete.
   * @returns {Promise&lt;any>} A validation message.
   */
  deleteIdentity(handle) {
    if (handle === this.account.handle) {
      throw new Error("Cannot delete the default identity for the logged in account");
    }
    return this.#identities.deleteAlias(handle);
  }

  /**
   * Create a new private data for the passed in entity, private to the passed in handle.
   * @param {Object} options
   * @param {string} options.handle the handle which is creating the data.
   * @param {string} options.entityId the [id]{@link BaseModel#id} of the entity ({@link Message}, {@link Alias}, or {@link Account}) the data is attached to.
   * @param {Object} options.data the data to attach to the entity associated with the passed in entityId, private to the handle associated with the passed in handle.
   * @returns {Promise&lt;PrivateData>} the new private data.
   */
  createPrivateData({handle, entityId, data}) {
    handle = handle ?? this.account.handle;
    return this.#privateData.createPayload(handle, entityId, data);
  }

  /**
   * Get the private data associated with the passed in handle and entity.
   * @param {Object} options
   * @param {string} options.handle the handle associated with the data to get.
   * @param {string} options.entityId the [id]{@link BaseModel#id} of the entity ({@link Message}, {@link Alias}, or {@link Account}) the data to get is attached to.
   * @returns {Promise&lt;PrivateData>} the private data associated with the passed in handle and entity.
   */
  getPrivateData({handle, entityId}) {
    handle = handle ?? this.account.handle;
    return this.#privateData.getPayload(handle, entityId);
  }

  /**
   * Update the private data associated with the passed in handle and entity.
   * @param {Object} options
   * @param {string} options.handle the handle associated with the data to update.
   * @param {string} options.entityId the [id]{@link BaseModel#id} of the entity ({@link Message}, {@link Alias}, or {@link Account}) the data to update is attached to.
   * @param {Object} options.newData the new private data.
   * @returns {Promise&lt;PrivateData>} the updated private data.
   */
  updatePrivateData({handle = this.account.handle, entityId, newData}) {
    return this.#privateData.updatePayload(handle, entityId, newData);
  }

  /**
   * Delete the private data associated with the passed in handle and entity.
   * @param {Object} options
   * @param {string} options.handle the handle associated with the data to delete.
   * @param {string} options.entityId the [id]{@link BaseModel#id} of the entity ({@link Message}, {@link Alias}, or {@link Account}) the data to delete is attached to.
   * @returns {Promise&lt;any>} A validation message.
   */
  deletePrivateData({handle = this.account.handle, entityId}) {
    return this.#privateData.deletePayload(handle, entityId);
  }

  /**
   * Get all the friends of the passed in handle.
   * @param {string} handle the handle whose friends will be retrieved.
   * @returns {Promise&lt;Identity[]>} an array of handles. These are the passed in handle's friends.
   */
  getFriends(handle = this.account.handle) {
    return this.#friends.getFriendsForAlias(handle);
  }

  /**
   * Add a new friend to the friend list of the passed in handle.
   * @param {string} friendHandle the handle which is going to be added to ownAlias's friend list.
   * @param {Object} options
   * @param {string} [options.ownHandle] the handle adding a friend.
   * @returns {Promise&lt;any>} a validation message.
   */
  addFriend(friendHandle, {ownHandle} = {}) {
    ownHandle = ownHandle ?? this.account.handle;
    return this.#friends.addFriend(ownHandle, friendHandle);
  }

  /**
   * Remove a friend from the friend list of the passed in handle.
   * @param {string} friendHandle the handle which is going to be removed from ownAlias's friend list.
   * @param {Object} options
   * @param {string} [options.ownHandle] the handle removing a friend.
   * @returns {Promise&lt;any>} a validation message.
   */
  removeFriend(friendHandle, {ownHandle} = {}) {
    ownHandle = ownHandle ?? this.account.handle;
    return this.#friends.removeFriend(ownHandle, friendHandle);
  }

  /**
   * Given an array of Messages group the messages by unique groups of sender
   * and recipient handles. For example if Alice sends Bob a message and Bob
   * sends Alice a message both of those messages are in the same group since
   * the set of sender and recipient handles contains {Alice, Bob} for each
   * message.
   *
   * @param {Message[]} messages the messages to group by unique groups of senders and recipients.
   * @returns {Message[][]} an array where each element is a set of messages with a unique set of senders and recipients.
   */
  groupMessagesByUniqueRecipients(messages) {
    const msgKeyedByInterlocutorSets = messages.reduce(
      (
        r,
        v,
        i,
        a,
        k = [...new Set([v.sender.id, ...v.recipients.map((c) => c.id)])]
          .sort()
          .join("")
      ) => ((r[k] || (r[k] = [])).push(v), r),
      {}
    );

    return Object.values(msgKeyedByInterlocutorSets);
  }

  async subscribe(handle) {
    await this.#webSocket.openWebSocketFor(handle);
  }

  unsubscribe(handle) {
    this.#webSocket.closeWebSocketFor(handle);
  }
}
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"Account","link":"<a href=\"Account.html\">Account</a>"},{"title":"Account#toJSON","link":"<a href=\"Account.html#toJSON\">Account &rtrif; toJSON</a>"},{"title":"BaseModel","link":"<a href=\"BaseModel.html\">BaseModel</a>"},{"title":"BaseModel#toJSON","link":"<a href=\"BaseModel.html#toJSON\">BaseModel &rtrif; toJSON</a>"},{"title":"Client","link":"<a href=\"Client.html\">Client</a>"},{"title":"Client#addFriend","link":"<a href=\"Client.html#addFriend\">Client &rtrif; addFriend</a>"},{"title":"Client#createIdentity","link":"<a href=\"Client.html#createIdentity\">Client &rtrif; createIdentity</a>"},{"title":"Client#createPrivateData","link":"<a href=\"Client.html#createPrivateData\">Client &rtrif; createPrivateData</a>"},{"title":"Client#deleteIdentity","link":"<a href=\"Client.html#deleteIdentity\">Client &rtrif; deleteIdentity</a>"},{"title":"Client#deleteMessage","link":"<a href=\"Client.html#deleteMessage\">Client &rtrif; deleteMessage</a>"},{"title":"Client#deletePrivateData","link":"<a href=\"Client.html#deletePrivateData\">Client &rtrif; deletePrivateData</a>"},{"title":"Client#getFriends","link":"<a href=\"Client.html#getFriends\">Client &rtrif; getFriends</a>"},{"title":"Client#getIdentities","link":"<a href=\"Client.html#getIdentities\">Client &rtrif; getIdentities</a>"},{"title":"Client#getIdentity","link":"<a href=\"Client.html#getIdentity\">Client &rtrif; getIdentity</a>"},{"title":"Client#getLoggedInAccount","link":"<a href=\"Client.html#getLoggedInAccount\">Client &rtrif; getLoggedInAccount</a>"},{"title":"Client#getMessageById","link":"<a href=\"Client.html#getMessageById\">Client &rtrif; getMessageById</a>"},{"title":"Client#getMessages","link":"<a href=\"Client.html#getMessages\">Client &rtrif; getMessages</a>"},{"title":"Client#getPrivateData","link":"<a href=\"Client.html#getPrivateData\">Client &rtrif; getPrivateData</a>"},{"title":"Client#groupMessagesByUniqueRecipients","link":"<a href=\"Client.html#groupMessagesByUniqueRecipients\">Client &rtrif; groupMessagesByUniqueRecipients</a>"},{"title":"Client#login","link":"<a href=\"Client.html#login\">Client &rtrif; login</a>"},{"title":"Client#logout","link":"<a href=\"Client.html#logout\">Client &rtrif; logout</a>"},{"title":"Client#removeFriend","link":"<a href=\"Client.html#removeFriend\">Client &rtrif; removeFriend</a>"},{"title":"Client#sendMessage","link":"<a href=\"Client.html#sendMessage\">Client &rtrif; sendMessage</a>"},{"title":"Client#signup","link":"<a href=\"Client.html#signup\">Client &rtrif; signup</a>"},{"title":"Client#updateIdentity","link":"<a href=\"Client.html#updateIdentity\">Client &rtrif; updateIdentity</a>"},{"title":"Client#updateMessage","link":"<a href=\"Client.html#updateMessage\">Client &rtrif; updateMessage</a>"},{"title":"Client#updatePrivateData","link":"<a href=\"Client.html#updatePrivateData\">Client &rtrif; updatePrivateData</a>"},{"title":"Identity","link":"<a href=\"Identity.html\">Identity</a>"},{"title":"Identity#toJSON","link":"<a href=\"Identity.html#toJSON\">Identity &rtrif; toJSON</a>"},{"title":"Identity#toString","link":"<a href=\"Identity.html#toString\">Identity &rtrif; toString</a>"},{"title":"Message","link":"<a href=\"Message.html\">Message</a>"},{"title":"Message#toJSON","link":"<a href=\"Message.html#toJSON\">Message &rtrif; toJSON</a>"},{"title":"PrivateData","link":"<a href=\"PrivateData.html\">PrivateData</a>"},{"title":"PrivateData#toJSON","link":"<a href=\"PrivateData.html#toJSON\">PrivateData &rtrif; toJSON</a>"},{"title":"message","link":"<a href=\"global.html#event:message\">message</a>"},{"title":"messagedeletion","link":"<a href=\"global.html#event:messagedeletion\">messagedeletion</a>"},{"title":"messageupdate","link":"<a href=\"global.html#event:messageupdate\">messageupdate</a>"},{"title":"intersection","link":"<a href=\"global.html#intersection\">intersection</a>"},{"title":"messageEventDetails","link":"<a href=\"global.html#messageEventDetails\">messageEventDetails</a>"},{"title":"toArray","link":"<a href=\"global.html#toArray\">toArray</a>"},{"title":"unique","link":"<a href=\"global.html#unique\">unique</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
